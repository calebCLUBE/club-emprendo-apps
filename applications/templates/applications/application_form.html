{% extends "applications/base.html" %}
{% load app_extras %}

{% block title %}{{ form_def.name }} · Club Emprendo{% endblock %}

{% block role_chips %}
  {% if form_def.slug|slice:":1" == "E" %}
    <span class="ce-chip">Emprendedoras</span>
  {% elif form_def.slug|slice:":1" == "M" %}
    <span class="ce-chip">Mentoras</span>
  {% else %}
    {{ block.super }}
  {% endif %}
{% endblock %}

{% block content %}

  {% if rendered_description %}
    <div class="form-intro">
      {{ rendered_description|linebreaks }}
    </div>
  {% endif %}

  <div class="ce-form-header">
    <span class="ce-form-pill">
      {% if second_stage %}
        Paso 2 · Aplicación detallada
      {% else %}
        Paso 1 · Aplicación inicial
      {% endif %}
    </span>

    <h1 class="ce-form-title ce-heading">{{ form_def.name }}</h1>

    <p class="ce-form-subtitle">
      {% if second_stage %}
        Esta es la segunda parte del proceso de selección. Tómate tu tiempo para
        responder con calma; tus respuestas nos ayudan a conectar mejor mentoras
        y emprendedoras.
      {% else %}
        Cuéntanos un poco sobre ti y confirma si cumples con los requisitos del
        programa.
      {% endif %}
    </p>
  </div>

  {% if second_stage %}
    <div class="ce-alert">
      Tus datos básicos (nombre y correo) ya están registrados de la primera
      aplicación. Aquí nos enfocamos en conocer mejor tu experiencia,
      motivación y disponibilidad.
    </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}

    {% for field in form %}
      <div class="form-row">

        <label
          for="{{ field.id_for_label }}"
          {% if field.field.required %}class="required"{% endif %}
        >
          {{ field.label }}
        </label>

        {% if field.help_text %}
          <span class="form-help">{{ field.help_text }}</span>
        {% endif %}

        {# ---------- GRID QUESTION (HORARIO) ---------- #}
        {% if field.name == "q_session_availability" %}

          {% with
            days="Lunes,Martes,Miércoles,Jueves,Viernes,Sábado,Domingo"|split:","
            times="Mañana,Tarde,Noche"|split:","
          %}
          <div class="ce-grid-wrap">
            <table class="ce-grid">
              <thead>
                <tr>
                  <th></th>
                  {% for d in days %}
                    <th>{{ d }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for t in times %}
                  <tr>
                    <th>{{ t }}</th>
                    {% for d in days %}
                      <td>
                        {% for sub in field %}
                          {% if sub.choice_label == d|add:" - "|add:t %}
                            {{ sub.tag }}
                          {% endif %}
                        {% endfor %}
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% endwith %}

        {# ---------- NORMAL QUESTIONS ---------- #}
        {% else %}
          {{ field }}
        {% endif %}

        {% if field.errors %}
          <span class="form-help" style="color:#d14b4b;">
            {{ field.errors|striptags }}
          </span>
        {% endif %}
      </div>
    {% endfor %}

    <div class="ce-actions">
      <button type="submit" class="ce-button-primary">
        Enviar aplicación
      </button>
    </div>
  </form>

{% endblock %}
