{# templates/admin_dash/grading_home.html #}
{% extends "admin/base_site.html" %}

{% block content %}
  <div class="ce-admin-wrap">

    <h1 style="margin: 0 0 14px 0;">Grading</h1>

    <div style="margin-bottom: 14px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      <form method="get" action="" style="display:flex; gap:10px; align-items:center;">
        <label for="group" style="font-weight:600;">Group</label>
        <input
          id="group"
          name="group"
          type="text"
          value="{{ group }}"
          placeholder="e.g. 5"
          style="padding:6px 10px; border:1px solid #ccc; border-radius:6px; width:120px;"
        />
        <button class="button" type="submit">Filter</button>

        {% if group %}
          <a class="button" href="/admin/grading/" style="text-decoration:none;">Clear</a>
        {% endif %}
      </form>

      <div style="color:#666; font-size:13px;">
        Pending (no recommendation): <strong>{{ pending_count }}</strong>
      </div>
    </div>

    <div style="overflow:auto; border:1px solid #ddd; border-radius:10px; background:#fff;">
      <table style="border-collapse:collapse; width:100%; font-size:13px;">
        <thead>
          <tr>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Created</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">ID</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Form</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Name</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Email</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Overall</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Recommendation</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid #eee;">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for app in applications %}
            <tr>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0; white-space:nowrap;">
                {{ app.created_at }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0;">
                {{ app.id }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0;">
                {{ app.form.slug }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0;">
                {{ app.name }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0;">
                {{ app.email }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0;">
                {{ app.overall_score }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0;">
                {{ app.recommendation }}
              </td>
              <td style="padding:10px; border-bottom:1px solid #f0f0f0; white-space:nowrap;">
                <form
                  method="post"
                  action="{% url 'admin_grade_application' app.id %}{% if group %}?group={{ group }}{% endif %}"
                  style="display:inline;"
                >
                  {% csrf_token %}
                  <button class="button" type="submit">Grade</button>
                </form>

                <a
                  class="button"
                  style="text-decoration:none;"
                  href="{% url 'admin_database_submission_detail' app.id %}"
                >
                  View
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" style="padding:14px;">
                No applications found.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p style="margin-top:10px; color:#666; font-size:12px;">
      Tip: filter by Group (e.g. 5). “Grade” saves scores + recommendation onto the Application row.
    </p>

  </div>
{% endblock %}
