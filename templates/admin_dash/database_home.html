{% extends "admin/base_site.html" %}
{% block content %}

<h1>Database</h1>

{% if master_forms %}
  <h2 style="margin-top:18px;">Master Forms</h2>
  <ul style="margin: 8px 0 18px 0;">
    {% for fd in master_forms %}
      <li style="margin:6px 0;">
        <a href="{% url 'admin_database_form_detail' fd.slug %}">
          {{ fd.slug }} — {{ fd.name }} ({{ fd.submission_count|default:0 }})
        </a>

        &nbsp; — &nbsp;
        <a href="{% url 'admin_export_form_csv' fd.slug %}">CSV</a>
        &nbsp;|&nbsp;
        <a href="{% url 'admin_database_form_master_csv' fd.slug %}">MASTER CSV</a>

        {% if fd.admin_edit_url %}
          &nbsp;|&nbsp;
          <a class="button" href="{{ fd.admin_edit_url }}" target="_blank">Edit</a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endif %}

<h2 style="margin-top:18px;">All Groups by Application Type</h2>
<ul style="margin: 8px 0 18px 0;">
  <li style="margin:6px 0;">
    <a href="{% url 'admin_database_type_detail' 'E_A1' %}">
      E_A1 — all groups ({{ combined_type_counts.E_A1|default:0 }})
    </a>
    &nbsp; — &nbsp;
    <a href="{% url 'admin_database_type_master_csv' 'E_A1' %}">MASTER CSV</a>
  </li>
  <li style="margin:6px 0;">
    <a href="{% url 'admin_database_type_detail' 'E_A2' %}">
      E_A2 — all groups ({{ combined_type_counts.E_A2|default:0 }})
    </a>
    &nbsp; — &nbsp;
    <a href="{% url 'admin_database_type_master_csv' 'E_A2' %}">MASTER CSV</a>
  </li>
  <li style="margin:6px 0;">
    <a href="{% url 'admin_database_type_detail' 'M_A1' %}">
      M_A1 — all groups ({{ combined_type_counts.M_A1|default:0 }})
    </a>
    &nbsp; — &nbsp;
    <a href="{% url 'admin_database_type_master_csv' 'M_A1' %}">MASTER CSV</a>
  </li>
  <li style="margin:6px 0;">
    <a href="{% url 'admin_database_type_detail' 'M_A2' %}">
      M_A2 — all groups ({{ combined_type_counts.M_A2|default:0 }})
    </a>
    &nbsp; — &nbsp;
    <a href="{% url 'admin_database_type_master_csv' 'M_A2' %}">MASTER CSV</a>
  </li>
</ul>

<h2>Groups</h2>

{% if group_blocks %}
  {% for group, forms in group_blocks %}
    <details style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 10px;">
      <summary style="cursor:pointer;">
        <strong>Group {{ group.number }}</strong>
        — {{ group.start_month }} to {{ group.end_month }} {{ group.year }}
      </summary>

      {% if forms %}
        <ul style="margin-top:10px;">
          {% for fd in forms %}
            <li style="margin:6px 0;">
              <a href="{% url 'admin_database_form_detail' fd.slug %}">
                {{ fd.slug }} — {{ fd.name }} ({{ fd.submission_count|default:0 }})
              </a>

              &nbsp; — &nbsp;
              <a href="{% url 'admin_export_form_csv' fd.slug %}">CSV</a>
              &nbsp;|&nbsp;
              <a href="{% url 'admin_database_form_master_csv' fd.slug %}">MASTER CSV</a>

              {% if fd.admin_edit_url %}
                &nbsp;|&nbsp;
                <a class="button" href="{{ fd.admin_edit_url }}" target="_blank">Edit</a>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p><em>No forms in this group yet.</em></p>
      {% endif %}
    </details>
  {% endfor %}
{% else %}
  <p>No groups yet.</p>
{% endif %}

<hr style="margin: 24px 0;">

<h2>Surveys</h2>

<div style="display:flex; gap:40px; flex-wrap:wrap;">
  <div style="min-width:260px;">
    <h3>Emprendedoras</h3>

    {% if surveys_e %}
      <ul style="margin: 8px 0 18px 0;">
        {% for s in surveys_e %}
          <li style="margin:6px 0;">
            <a href="{% url 'admin_database_form_detail' s.slug %}">
              {{ s.name }} ({{ s.slug }}) — {{ s.submission_count|default:0 }}
            </a>

            &nbsp; — &nbsp;
            <a href="{% url 'admin_export_form_csv' s.slug %}">CSV</a>
            &nbsp;|&nbsp;
            <a href="{% url 'admin_database_form_master_csv' s.slug %}">MASTER CSV</a>

            {% if s.admin_edit_url %}
              &nbsp;|&nbsp;
              <a class="button" href="{{ s.admin_edit_url }}" target="_blank">Edit survey</a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p><em>No Emprendedora surveys found.</em></p>
    {% endif %}
  </div>

  <div style="min-width:260px;">
    <h3>Mentoras</h3>

    {% if surveys_m %}
      <ul style="margin: 8px 0 18px 0;">
        {% for s in surveys_m %}
          <li style="margin:6px 0;">
            <a href="{% url 'admin_database_form_detail' s.slug %}">
              {{ s.name }} ({{ s.slug }}) — {{ s.submission_count|default:0 }}
            </a>

            &nbsp; — &nbsp;
            <a href="{% url 'admin_export_form_csv' s.slug %}">CSV</a>
            &nbsp;|&nbsp;
            <a href="{% url 'admin_database_form_master_csv' s.slug %}">MASTER CSV</a>

            {% if s.admin_edit_url %}
              &nbsp;|&nbsp;
              <a class="button" href="{{ s.admin_edit_url }}" target="_blank">Edit survey</a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p><em>No Mentora surveys found.</em></p>
    {% endif %}
  </div>
</div>

{% endblock %}
