<div>
  {% if sections %}
    <ul style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px;">
      {% for s in sections %}
        <li style="border:1px solid rgba(0,0,0,0.06); border-radius:10px; padding:10px; background:#fafafa;">
          <form
            hx-post="{% url 'builder:section_update' s.id %}"
            hx-target="#section-list"
            hx-swap="innerHTML"
          >
            {% csrf_token %}
            <div style="display:flex; gap:8px; align-items:center;">
              <input class="ce-input" name="title" value="{{ s.title }}" style="flex:1;" />
              <input type="number" class="ce-input" name="position" value="{{ s.position }}" style="width:80px;" min="0" />
              <button class="ce-btn" type="submit">Guardar</button>
              <button class="ce-btn ce-btn-danger"
                      type="button"
                      hx-post="{% url 'builder:section_delete' s.id %}"
                      hx-target="#section-list"
                      hx-swap="innerHTML"
                      hx-confirm="¿Eliminar esta sección? Las preguntas se mantendrán sin sección.">
                ✕
              </button>
            </div>
            <textarea class="ce-input" name="description" rows="2" style="margin-top:8px;">{{ s.description }}</textarea>
            <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
              <label class="ce-label" style="font-size:12px; margin:0;">Mostrar si</label>
              <select class="ce-input" name="show_if_question" style="flex:1;" data-show-if-question>
                <option value="">— Siempre —</option>
                {% for q in form_def.questions.all %}
                  {% if q.field_type == "boolean" %}
                    <option value="{{ q.id }}"
                            data-opt-values="yes|no"
                            data-opt-labels="Sí|No"
                            {% if s.show_if_question_id == q.id %}selected{% endif %}>{{ q.text|default:q.slug }}</option>
                  {% elif q.field_type == "choice" or q.field_type == "multi_choice" %}
                    <option value="{{ q.id }}"
                            data-opt-values="{% for c in q.choices.all %}{{ c.value }}{% if not forloop.last %}|{% endif %}{% endfor %}"
                            data-opt-labels="{% for c in q.choices.all %}{{ c.label|default:c.value }}{% if not forloop.last %}|{% endif %}{% endfor %}"
                            {% if s.show_if_question_id == q.id %}selected{% endif %}>{{ q.text|default:q.slug }}</option>
                  {% else %}
                    <option value="{{ q.id }}"
                            data-opt-values=""
                            data-opt-labels=""
                            {% if s.show_if_question_id == q.id %}selected{% endif %}>{{ q.text|default:q.slug }}</option>
                  {% endif %}
                {% endfor %}
              </select>
              <select class="ce-input" name="show_if_value" style="flex:1;" data-show-if-value data-current="{{ s.show_if_value }}">
                <option value="">Selecciona valor</option>
              </select>
            </div>
            {% include "builder/partials/section_condition_help.html" %}
            <div class="ce-muted" style="font-size:12px; margin-top:6px;">
              {{ s.questions.count }} preguntas
              {% if s.show_if_question %}
                · Condición: {{ s.show_if_question.text|default:s.show_if_question.slug }} == "{{ s.show_if_value|default:"" }}"
              {% endif %}
            </div>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="ce-muted" style="margin:0;">No hay secciones. Agrega una para dividir el formulario.</p>
  {% endif %}
</div>
